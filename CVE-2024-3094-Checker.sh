#!/bin/bash
                                                                                                                             
echo "   _____   _____   ___ __ ___ _ _     ____ __  ___ _ _  "
echo "  / __\ \ / / __|_|_  )  \_  ) | | __|__ //  \/ _ \ | | "
echo " | (__ \ V /| _|___/ / () / /|_  _|___|_ \ () \_, /_  _|"
echo "  \___| \_/ |___| /___\__/___| |_|   |___/\__/ /_/  |_| "
                                                        
echo -e "\n                                       -TorjanCaptain\n\n\n"

# Disclaimer:
# This script is provided without any warranty, express or implied.
# By choosing to execute this script, you accept full responsibility for any consequences that may arise.
# The author(s) disclaim liability for any damages or issues, including data loss or system instability, resulting from its use.
# Before running this script, it is advisable to carefully review its functionality and ensure appropriate backups are in place.
# Your use of this script implies your acknowledgment and acceptance of these terms.
# Author: TorjanCaptain


# Check if xz package is installed
if ! command -v xz &> /dev/null; then
    echo "[-] xz package is not installed."
    exit 1
fi

# Check xz-utils package version
xz_version_dpkg=$(dpkg -l | grep "xz-utils"| awk '{print $3}')
#echo "Your dpkg version is $xz_version_dpkg"
xz_version_dpkg_init_val=$(echo "$xz_version_dpkg" | cut -d'+' -f1)

# Check xz version
xz_version=$(xz --version | head -n 1 | awk '{print $4}')

# Check vulnerability status
if [[ $xz_version == "5.6.0" || $xz_version == "5.6.1" ]]; then
    echo -e "\n[*] Your xz version ($xz_version) is vulnerable to CVE-2024-3094."
    echo -e "    It is recommended to downgrade to a non-vulnerable version."
    echo -e "    Refer to: https://www.rapid7.com/blog/post/2024/04/01/etr-backdoored-xz-utils-cve-2024-3094/"
else
    echo -e " \n[*] Your xz version ($xz_version) is NOT vulnerable to CVE-2024-3094."
    if [[ $xz_version_dpkg_init_val == "5.6.0" || $xz_version_dpkg_init_val == "5.6.1" ]] && [[ "$xz_version_dpkg" == *"+really"* ]]; then
        echo -e "\nBut..you still may have a LOW vulnerability."
        echo -e "Please refer:https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=1068024"
    fi
fi
